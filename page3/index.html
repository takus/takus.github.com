
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>TAKUMI SAKAMOTO&#8217;S BLOG</title>
  <meta name="author" content="Takumi Sakamoto">

  
  <meta name="description" content="一日に数回 MySQL が詰まるような現象があったので原因を調べたところ、そのサーバだけ innodb_stats_on_metadata=1 になっていたのが原因だったという話デス。 innodb_stats_on_metadata は、テーブルのメタデータにアクセスしたときに InnoDB &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.takus.me/page3/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="TAKUMI SAKAMOTO'S BLOG" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2841066-12']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">TAKUMI SAKAMOTO&#8217;S BLOG</a></h1>
  
    <h2>A weblog about Web Operations, Programming, Football, Travel and Other My Interests.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.takus.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="http://about.me/takus">AboutMe</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/12/21/innodb-stats-on-metadata/">innodb_stats_on_metadata に要注意</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2013/12/21/innodb-stats-on-metadata/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2013/12/21/innodb-stats-on-metadata/"></a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-21T18:25:00+09:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>6:25 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>一日に数回 MySQL が詰まるような現象があったので原因を調べたところ、そのサーバだけ <code>innodb_stats_on_metadata=1</code> になっていたのが原因だったという話デス。</p>

<p><code>innodb_stats_on_metadata</code> は、テーブルのメタデータにアクセスしたときに InnoDB の統計情報を更新するかどうかのフラグで、今回問題が起こっていたサーバのようにデータ量が多いサーバなどでは無効にしておく必要があります。例えば、<a href="http://dev.mysql.com/doc/refman/5.1-olh/ja/innodb-parameters.html#sysvar_innodb_stats_on_metadata">公式ドキュメント</a> の <code>innodb_stats_on_metadata</code> の部分にはこのように書いてあります。</p>

<blockquote><p>この変数が有効 (この変数が作成される前からのデフォルト) な場合、<code>SHOW TABLE STATUS</code> や <code>SHOW INDEX</code> などのメタデータステートメントの実行時や、<code>INFORMATION_SCHEMA</code> テーブル <code>TABLES</code> または <code>STATISTICS</code> へのアクセス時に、InnoDB は統計情報を更新します。(これらの更新は、<code>ANALYZE TABLE</code> で行われるものに似ている。) 無効な場合、InnoDB はそれらの処理中に統計情報を更新しません。この変数を無効にすると、テーブルやインデックスを多数含むスキーマへのアクセス速度が改善される可能性があります。またその場合、InnoDB テーブルが関係するクエリーの実行計画の安定性も高まる可能性があります。</p></blockquote>

<p>他にも MySQL Performance Blog の <a href="http://www.mysqlperformanceblog.com/2011/12/23/solving-information_schema-slowness/">Solving INFORMATION_SCHEMA slowness</a> という記事や、High Performance MySQL 3rd Edition の 5 章にもこのオプションに関する言及がありました。</p>

<p>性能に影響与えるようなオプションであればデフォルトで無効にしておいてくれればいいのにと思っていたら、<a href="https://blogs.oracle.com/supportingmysql/entry/server_defaults_changes_in_mysql">MySQL 5.6 からデフォルトで無効</a>になるようです。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/11/10/roadworker/">Roadworker - The Best Way to Manage Your Amazon Route53 Records</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2013/11/10/roadworker/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2013/11/10/roadworker/"></a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-10T15:43:00+09:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>3:43 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>What is Roadworker?</h2>

<p>According to <a href="https://twitter.com/sgwr_dts">@sgwr_dts</a> (the author of roadworker), <a href="https://bitbucket.org/winebarrel/roadworker">Roadworker</a> is a tool to manage <a href="http://aws.amazon.com/en/route53/">Amazon Route53</a>. It defines the state of Route53 using DSL, and updates Route53 according to DSL.</p>

<h2>Why we should avoid using Route53&rsquo;s web console?</h2>

<p>Definitely, Amazon Route53 is one of the best DNS hosting service.</p>

<ul>
<li>Highly Available

<ul>
<li>SLA 100%!!</li>
</ul>
</li>
<li>Cost-Effective

<ul>
<li>basically $0.50 per hosted zone / $0.500 per million queries</li>
</ul>
</li>
<li>Simple

<ul>
<li>You can start to use within minutes</li>
</ul>
</li>
</ul>


<p>But Managing Route53 via its web console is slightly painful.</p>

<ul>
<li>Not resilient to human error

<ul>
<li>Just a single click may delete a important record</li>
<li>Difficult to review before applying</li>
</ul>
</li>
<li>No changing histories at all

<ul>
<li>After updating many records, it is difficult to revert the original state</li>
</ul>
</li>
</ul>


<p>Roadworker resolves these issues by defining DNS records as DSL. I&rsquo;ll show how Roadworker can help you in this article.</p>

<h2>Getting Started with Roadworker</h2>

<p>Getting started with Roadworker is easy! Open a terminal window and run this command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>gem install roadworker
</span></code></pre></td></tr></table></div></figure>


<p>After installing Roadworker, set <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> for requesting Route53&rsquo;s APIs.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span><span class="s1">&#39;...&#39;</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span><span class="s1">&#39;...&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>At first, export current records like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>roadwork -e -o Routefile
</span></code></pre></td></tr></table></div></figure>


<p>This is a exported <code>Routefile</code>. Easy to manage with git or other VCSs, isn&rsquo;t it?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">hosted_zone</span> <span class="s2">&quot;takus.me.&quot;</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">rrset</span> <span class="s2">&quot;takus.me.&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">ttl</span> <span class="mi">3600</span>
</span><span class='line'>    <span class="n">resource_records</span><span class="p">(</span>
</span><span class='line'>      <span class="s2">&quot;219.94.233.169&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">rrset</span> <span class="s2">&quot;takus.me.&quot;</span><span class="p">,</span> <span class="s2">&quot;MX&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">ttl</span> <span class="mi">3600</span>
</span><span class='line'>    <span class="n">resource_records</span><span class="p">(</span>
</span><span class='line'>      <span class="s2">&quot;10 mail.takus.me&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">rrset</span> <span class="s2">&quot;mail.takus.me.&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">ttl</span> <span class="mi">3600</span>
</span><span class='line'>    <span class="n">resource_records</span><span class="p">(</span>
</span><span class='line'>      <span class="s2">&quot;219.94.233.169&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">rrset</span> <span class="s2">&quot;blog.takus.me.&quot;</span><span class="p">,</span> <span class="s2">&quot;CNAME&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">ttl</span> <span class="mi">3600</span>
</span><span class='line'>    <span class="n">resource_records</span><span class="p">(</span>
</span><span class='line'>      <span class="s2">&quot;takus.github.com&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>As I mentioned above, updating DNS records causes a disaster like deleting unexpected records.
But you can update them safely with <code>--dry-run</code> option.
In the case below, I can notice the mistake (deleting the record for this blog) before updating actually.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>roadwork --apply --dry-run
</span><span class='line'>Apply <span class="sb">`</span>Routefile<span class="sb">`</span> to Route53 <span class="o">(</span>dry-run<span class="o">)</span>
</span><span class='line'>Delete ResourceRecordSet: blog.takus.me. CNAME <span class="o">(</span>dry-run<span class="o">)</span>
</span><span class='line'>No change
</span></code></pre></td></tr></table></div></figure>


<p>After updating records, you may want to test whether all records are correct state. Roadworker provides <code>-t</code> option for comparing the results of a query to the DNS and DSL.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>roadwork -t
</span><span class='line'>.......
</span><span class='line'>7 examples, 0 failure
</span></code></pre></td></tr></table></div></figure>


<h2>Conclusion</h2>

<p>You should use Roadworker for managing Amazon Route53 records instead of its web console. Roadworker enables us to manage DNS records safely with recording all update histories.</p>

<h2>References</h2>

<ul>
<li><a href="http://rubygems.org/gems/roadworker">http://rubygems.org/gems/roadworker</a></li>
<li><a href="https://bitbucket.org/winebarrel/roadworker">https://bitbucket.org/winebarrel/roadworker</a></li>
<li><a href="http://aws.amazon.com/en/route53/">http://aws.amazon.com/en/route53/</a></li>
<li><a href="http://dev.classmethod.jp/cloud/aws/route53-as-code-roadworker/">http://dev.classmethod.jp/cloud/aws/route53-as-code-roadworker/</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/11/02/daemontools-setuidgid/">daemontools の setuidgid が supplementary groups 権限をつけてくれない件</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2013/11/02/daemontools-setuidgid/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2013/11/02/daemontools-setuidgid/"></a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-02T01:40:00+09:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2013</span></span> <span class='time'>1:40 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>『<a href="http://cr.yp.to/daemontools/setuidgid.html">daemontools の setuidgid</a>』や 『<a href="http://d.hatena.ne.jp/hirose31/20130808/1375965331">補助グループ権限もつけてくれるsetuidgidのようなもの</a>』のところに書いてある話なんですが、<code>daemontools</code> の <code>setuidgid</code> は 補助グループ権限をつけてくれません。</p>

<p>どういうことかというと、<code>sysadmin</code> グループに属する <code>admin</code> ユーザがいて、下記のような設定になってるときに、</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>id admin
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>2500<span class="o">(</span>admin<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>2500<span class="o">(</span>admin<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>2500<span class="o">(</span>admin<span class="o">)</span>,2501<span class="o">(</span>sysadmin<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>ls -l /home/admin/password.pl
</span><span class='line'>-rw-r----- 1 root sysadmin 584 Jul 24 22:47 /home/admin/password.pl
</span></code></pre></td></tr></table></div></figure>


<p>下記のような run ファイルで daemon を起動したところ、password.pl が読めないというエラーが出ました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'><span class="nb">exec </span>2&gt;&amp;1
</span><span class='line'><span class="nb">exec </span>setuidgid admin /path/to/oreno_daemon
</span></code></pre></td></tr></table></div></figure>


<p>一見すると、<code>admin</code> ユーザは <code>sysadmin</code> ユーザに含まれているため権限は問題ないように思えて、実際にコンソールから実行すると読むことができるのですが、前述の通り <code>setuidgid</code> は補助グループ権限をつけてくれないため、<code>setuidgid</code> で指定した <code>admin</code> ユーザは下記のようなユーザとみなされ、password.pl を読むことができないというオチでした。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>id admin
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>2500<span class="o">(</span>admin<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>2500<span class="o">(</span>admin<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>2500<span class="o">(</span>admin<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>解決策は、『<a href="http://d.hatena.ne.jp/hirose31/20130808/1375965331">補助グループ権限もつけてくれるsetuidgidのようなもの</a>』にまとまってますが、<a href="https://gist.github.com/kazuho/6181648">この辺り</a>を使うのがいいのではないかと思ってる次第です。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/10/18/yapc-devopsday-wakateweb/">#yapcasia と #devopsday と #wakateweb の話</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2013/10/18/yapc-devopsday-wakateweb/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2013/10/18/yapc-devopsday-wakateweb/"></a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-10-18T04:05:00+09:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>4:05 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>9 月後半から 10 月前半にかけて、#yapcasia と #depopsday と #wakateweb といったイベントに参加させていただきましたが、全くブログに書いてなかったので簡単にまとめておきます。</p>

<h2><a href="http://yapcasia.org/2013/">YAPC::ASIA 2013</a></h2>

<p>今回の YAPC も最高に楽しい 3 日間でした。会場が日吉ということで、なんだか学生時代に戻ったような気分で参加していた気がします。</p>

<h3>Rubyの良いところ語ってください 〜そんなPerlで大丈夫か？〜</h3>

<p><a href="http://yapcasia.org/2013/talk/show/c6b08f02-f293-11e2-ba15-895a6aeab6a4">Perl が盛大に dis られる座談会</a>なのかと思っていましたがそんなこともなく、<a href="http://shyouhei.tumblr.com/post/44451702850/1">卜部さんのブログに書いてあること</a> が全てな印象でした。流行りと廃りはどんな言語・技術にもあるもので、トレンドの変化が起きた時に移行すべきなのにできないというように、何かに固執する (固執せざるを得なくなる) のがほんとのリスクじゃないでしょうか。</p>

<h3>フルテストも50msで終わらせたい 〜FreakOutの取り組み〜</h3>

<p><a href="http://yapcasia.org/2013/talk/show/767463b0-d8fd-11e2-971a-72936aeab6a4">このトーク</a>で印象に残ってるのが、「テストを爆速にした結果、手元でやるより push したほうが速くて、みんな push しだした」という部分で、これによって他の人の開発アクティビティが見えやすくなったとおっしゃっていましたが、まさしくツールで文化を変えていくような例でスバラシイと思いました。組織で何かに取り組もうとしたときに、こうしましょうって決めても、人によって温度感がバラバラでなかなか浸透しなかったりなんてことはよくあるので、気持ちよく走れるレールを敷いてあげて、自然にいい方向に持ってけれるような仕事の仕方をしていけるといいですね！</p>

<h3>さいごに</h3>

<p>1 日目の夜に Facebook で @nekokak さんが「喋りたくなったから喋る」みたいなこと書いてるの見て、そういえば去年の YAPC のブログでも次は発表したいとか書いてたなって思い出して、<a href="http://yapcasia.org/2013/talk/show/167ebc52-221e-11e3-94a0-fa546aeab6a4">LT に応募して喋ってきました</a>。時間ないから 3 分でと言われて早口で喋ってたのでだいぶ微妙な感じでしたが、やらないよりはやって失敗して学んでいくタイプなので次回にご期待ください&hellip;。</p>

<p>最後に、今回の YAPC を最後に櫛井さんと牧さんが運営から離れるとのことでしたが、今まで本当にお疲れさまでした。自分が参加させていただいた 3 回の YAPC はどれもほんとに楽しくて、勉強になって、素晴らしい時間を過ごすことができました。この場を借りて、お礼を言わせていただきたいです。本当にありがとうございました！！！</p>

<h2><a href="http://devopsdays.org/events/2013-tokyo/">DevOpsDay Tokyo 2013</a></h2>

<p>Github の @johndbritton さんが <a href="https://speakerdeck.com/johndbritton/ops-for-everyone">Ops for Everyone</a> の中で、「<a href="http://hubot.github.com/">Hubot</a> は全員のターミナルをシェアするみたいな考え方で、オペレーションの可視化を実現している」といったことを言っていて、うんうんって思いながら聞いていました。新しく入ってきた人はそれ見ながらどういう操作すればいいか勉強できるし、いま各々がどういうことやっているかも把握しやすくなりそうだし、Hubot を中心にしたオペレーションはかなりアリなんじゃないかと思います。</p>

<p>余談ですが、<code>/graph me</code> でグラフ出せる機能を拡張して、<code>/graph me</code> 呼んだときに GrowthForecast(RRD) のグラフを 社内 Gyazo とかにあげて、そのリンクを IRC にポストしてくれたりすると、後で IRC のログ振り返るときにそのとき見てたグラフが表示できて捗りそうかなーとか思いました。(RRD は後で見ようと思っても丸められてしまうので）</p>

<h2><a href="http://www.zusaar.com/event/1063003">第 6 回若手 Web エンジニア交流会</a></h2>

<p>これが一番最近ですが、6 回目はとうとう Google Japan で開催させていただきました。トークについては YAPC::ASIA のときと同じ Velocity の話だったんですが、こっちのスライドの方が完成度高いのでブログにはこっちだけ載せておきます(笑) トークの中で Google のプレゼン機材が再起動し始めてスクリーンになぜか自分の姿が映し出されるというだいぶ恥ずかしい感じでしたが、それなりに興味をもって聞いていただけたみたいでよかったです。</p>

<p>あと、今回から正式に #wakateweb のハッシュタグ使いましょうってアナウンスしたところ、それ使ってつぶやいてくれる人が多くて、後で見返したときとか探しやすくていいので、主催者側でちゃんとアナウンスするの大事だなって思います。</p>

<script async class="speakerdeck-embed" data-id="2eb68c500dac013190b426a0f1d35487" src="//speakerdeck.com/assets/embed.js"></script>


<h2>まとめ</h2>

<p>ということで、結論としては、イベントに参加したら記憶が新鮮なうちにさっさとまとめましょう&hellip;。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/08/11/mysql_secure_installation/">mysql_secure_installation の中身</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2013/08/11/mysql_secure_installation/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2013/08/11/mysql_secure_installation/"></a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-08-11T11:06:00+09:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>11:06 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>単純に気になったので。5.1 系のソース眺めただけです。</p>

<h2>root ユーザのパスワード文字列を設定</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Set the root password
</span><span class='line'>UPDATE mysql.user SET Password=PASSWORD('password') WHERE User='root';</span></code></pre></td></tr></table></div></figure>


<h2>anonymous ユーザを削除</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Remove anonymous users
</span><span class='line'>DELETE FROM mysql.user WHERE User='';</span></code></pre></td></tr></table></div></figure>


<h2>リモートからの root ログインを禁止する</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Disallow remote root login
</span><span class='line'>DELETE FROM mysql.user
</span><span class='line'>WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');</span></code></pre></td></tr></table></div></figure>


<h2>test データベースを削除する</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Remove test database
</span><span class='line'>DROP DATABASE test;
</span><span class='line'>DELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';</span></code></pre></td></tr></table></div></figure>


<h2>権限を再読み出しする</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Reload privilege tables
</span><span class='line'>FLUSH PRIVILEGES;`</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/08/06/nagira-nagios-restful-api/">nagira という Nagios RESTful API が便利そうな件</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2013/08/06/nagira-nagios-restful-api/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2013/08/06/nagira-nagios-restful-api/"></a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-08-06T10:46:00+09:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>10:46 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>オートスケーリングみたいなことをしようとする場合、サービスインする前に監視が全て OK になっているかチェック
しておきたいみたいな需要がありますが、みんな大好き Nagios でこれをやろうとするとちょっと面倒だったりします。</p>

<p><a href="http://search.cpan.org/~duncs/Nagios-Object-0.21.18/lib/Nagios/StatusLog.pm">Nagios::StatusLog</a> のようなものを使って <code>status.dat</code> をパースする方法がお手軽ですが、監視するホストが数千台みたいな環境だと <code>status.dat</code> が結構な大きさになってしまい、必要なたびにパースしてると Nagios が動いてるホストが結構なメモリを喰って swap に入ってしまったり、他のホストに転送してパースするにしてもそれなりに帯域喰ってしまうので、Nagios のホスト上で <code>status.dat</code> をパースして一定期間キャッシュし、HTTP でよしなに JSON を返してくれればいいなとか思っていたら、<a href="https://github.com/dmytro/nagira">nagira</a> でそれが実現できそうだったので試してみました。</p>

<p>ちなみに <code>nagira</code> は <code>NAGIos Restful Api</code> を意味しているようです。</p>

<h2>インストール</h2>

<p><code>nagira</code> は <code>Sinatra</code> なアプリなので、<code>bundler</code> で適当な場所にインストールします。</p>

<figure class='code'><figcaption><span>install</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone https://github.com/dmytro/nagira.git
</span><span class='line'><span class="nb">cd </span>nagira
</span><span class='line'>bundle install --path vendor/bundle --binstubs
</span></code></pre></td></tr></table></div></figure>


<p>nagira 自体には init スクリプトとかを準備してくれる仕組みがあって、conf は RHEL なら <code>/etc/sysconfig/nagira</code> を見にいきますが、今回は daemontools を使いたかったので下記のような run ファイルを用意して、conf も <code>/etc/nagira.conf</code> あたりにおいておきます。ちなみにキャッシュする時間は <code>NAGIRA_TTL</code> で調整できるみたいです。</p>

<figure class='code'><figcaption><span>daemontools run file</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'><span class="nb">exec </span>2&gt;&amp;1
</span><span class='line'>
</span><span class='line'><span class="nb">export </span><span class="nv">APP_ROOT</span><span class="o">=</span>/path/to/nagira
</span><span class='line'><span class="nb">export </span><span class="nv">RACK_ENV</span><span class="o">=</span>production
</span><span class='line'>. /etc/nagira.conf
</span><span class='line'>
</span><span class='line'><span class="nb">exec </span>setuidgid nagios <span class="se">\</span>
</span><span class='line'>    <span class="nv">$APP_ROOT</span>/bin/nagira
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>nagira.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># Defaults configuration file for Nagira</span>
</span><span class='line'><span class="c"># --------------------------------------------</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># Port. Default 4567</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="nv">NAGIRA_PORT</span><span class="o">=</span>4567
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># BIND</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># String specifying the hostname or IP address of the interface to</span>
</span><span class='line'><span class="c"># listen on when the :run setting is enabled. The default value –</span>
</span><span class='line'><span class="c"># &#39;0.0.0.0&#39; – causes the server to listen on all available</span>
</span><span class='line'><span class="c"># interfaces. To listen on the loopback interface only, use: &#39;localhost&#39;</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nv">NAGIRA_BIND</span><span class="o">=</span>0.0.0.0
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># Environment</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># Usually needs to be production</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nv">RACK_ENV</span><span class="o">=</span>production
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># Nagira user</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># Usually nagira process should be run by same user ID as Nagios. In</span>
</span><span class='line'><span class="c"># many cases this is nagios user.</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nv">NAGIRA_USER</span><span class="o">=</span>nagios
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># RVM</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># RVM_STRING=&quot;rvm use default&quot;</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># Log file</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="nv">NAGIRA_LOG</span><span class="o">=</span>/path/to/nagira.log
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># TTL for data</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># Number of seconds between re-parses. All Nagios file are parsed no</span>
</span><span class='line'><span class="c"># more often than this. Default is 5 sec. Setting this to 0 or</span>
</span><span class='line'><span class="c"># negative number disables TTL and backgroiund prser as well.</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nv">NAGIRA_TTL</span><span class="o">=</span>30
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># Background parsing</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># Set this to 0, to disable background parsing.</span>
</span><span class='line'><span class="nv">NAGIRA_BG_PARSING</span><span class="o">=</span>1
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># Nagios configuration file</span>
</span><span class='line'><span class="c"># ----------------------</span>
</span><span class='line'><span class="c"># Where main Nagios configuration file is located. usually this does</span>
</span><span class='line'><span class="c"># not need to change.</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nv">NAGIOS_CFG_FILE</span><span class="o">=</span>/path/to/nagios.cfg
</span></code></pre></td></tr></table></div></figure>


<h2>出力例</h2>

<p>こんな感じで監視してるホストの一覧とか、サービスの状態が json で取得できるので色々と捗りそうです。ちなみに API は<a href="https://github.com/dmytro/nagira/blob/master/docs/API.md">この辺り</a>に載っています。また、<code>| python -mjson.tool</code> で json 渡すとよしなにやってくれることを昨日知りました。情弱ですいません。</p>

<figure class='code'><figcaption><span>examples</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl -s http://nagios.example.com:4567/_status/_list | python -mjson.tool
</span><span class='line'><span class="o">[</span>
</span><span class='line'>    <span class="s2">&quot;host0001&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;host0002&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;host0003&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;host0004&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;host0005&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;host0006&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;host0007&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;host0008&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;host0009&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;host0010&quot;</span>,
</span><span class='line'><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>curl -s http://nagios.example.com:4567/_status/host0001/_services | python -mjson.tool
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;CPU&quot;</span>: <span class="o">{</span>
</span><span class='line'>        <span class="s2">&quot;acknowledgement_type&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;active_checks_enabled&quot;</span>: <span class="s2">&quot;1&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;check_command&quot;</span>: <span class="s2">&quot;check_cpu!60&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;check_execution_time&quot;</span>: <span class="s2">&quot;0.149&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;check_interval&quot;</span>: <span class="s2">&quot;120.000000&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;check_latency&quot;</span>: <span class="s2">&quot;0.211&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;check_options&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;check_period&quot;</span>: <span class="s2">&quot;24x7&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;check_type&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;current_attempt&quot;</span>: <span class="s2">&quot;1&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;current_event_id&quot;</span>: <span class="s2">&quot;248&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;current_notification_id&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;current_notification_number&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;current_problem_id&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;current_state&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;event_handler_enabled&quot;</span>: <span class="s2">&quot;1&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;failure_prediction_enabled&quot;</span>: <span class="s2">&quot;1&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;flap_detection_enabled&quot;</span>: <span class="s2">&quot;1&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;has_been_checked&quot;</span>: <span class="s2">&quot;1&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;host_name&quot;</span>: <span class="s2">&quot;host0001&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;is_flapping&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;last_check&quot;</span>: <span class="s2">&quot;1375751157&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;last_event_id&quot;</span>: <span class="s2">&quot;243&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;last_hard_state&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;last_hard_state_change&quot;</span>: <span class="s2">&quot;1374725239&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;last_notification&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;last_problem_id&quot;</span>: <span class="s2">&quot;108&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;last_state_change&quot;</span>: <span class="s2">&quot;1374725239&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;last_time_critical&quot;</span>: <span class="s2">&quot;1374724999&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;last_time_ok&quot;</span>: <span class="s2">&quot;1375751157&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;last_time_unknown&quot;</span>: <span class="s2">&quot;1374725119&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;last_time_warning&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;last_update&quot;</span>: <span class="s2">&quot;1375751195&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;max_attempts&quot;</span>: <span class="s2">&quot;3&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;modified_attributes&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;next_check&quot;</span>: <span class="s2">&quot;1375751277&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;next_notification&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;no_more_notifications&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;notification_period&quot;</span>: <span class="s2">&quot;24x7&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;notifications_enabled&quot;</span>: <span class="s2">&quot;1&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;obsess_over_service&quot;</span>: <span class="s2">&quot;1&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;passive_checks_enabled&quot;</span>: <span class="s2">&quot;1&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;percent_state_change&quot;</span>: <span class="s2">&quot;0.00&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;plugin_output&quot;</span>: <span class="s2">&quot;CPU OK : CPU(Usr) =&gt; 0 CPU(Sys) =&gt; 0  CPU(IOwait) =&gt; 1&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;problem_has_been_acknowledged&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;process_performance_data&quot;</span>: <span class="s2">&quot;1&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;retry_interval&quot;</span>: <span class="s2">&quot;8.000000&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;scheduled_downtime_depth&quot;</span>: <span class="s2">&quot;0&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;service_description&quot;</span>: <span class="s2">&quot;CPU&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;should_be_scheduled&quot;</span>: <span class="s2">&quot;1&quot;</span>,
</span><span class='line'>        <span class="s2">&quot;state_type&quot;</span>: <span class="s2">&quot;1&quot;</span>
</span><span class='line'>    <span class="o">}</span>,
</span></code></pre></td></tr></table></div></figure>


<h2>まとめ</h2>

<p>Nagios 自体がこの機能を提供してよと思うところもありますが、とりあえずこれでやりたいことは実現できそうなので、もう少し実践的な場面で試していきたい所存です。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/06/21/velocity-conference-santa-clara-2013/">Velocity 2013 に参加 & LT してきました！！</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2013/06/21/velocity-conference-santa-clara-2013/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2013/06/21/velocity-conference-santa-clara-2013/"></a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-06-21T00:00:00+09:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>6/18 ~ 6/20 に Santa Clara で開催された <a href="http://velocityconf.com/velocity2013/">Velocity 2013</a> に参加して来ました。Velocity は Web Performance や Web Operation などが主なテーマで、Google、Facebook、Twitter、Amazon、Yahoo! などをはじめとした様々な企業から 1,000 人以上が参加する大規模なカンファレンスです。いまやよく耳にする <em>DevOps</em> というキーワードも <a href="http://www.youtube.com/watch?v=LdOe18KhtT4">10+ Deploys Per Day: Dev and Ops Cooperation at Flickr</a> という Velocity 2009 のトークで有名になった言葉ですね。</p>

<p>参加するにあたって、@xaicron さんの <a href="http://blog.livedoor.jp/xaicron/archives/54515196.html">勝手に YAPC::NA 2013 に行ってきた！！</a> と同じく、会社が渡航費、宿泊費、参加費等の全ての費用を負担してくれました！！新卒入社 2 年目の自分をこのような素晴らしいカンファレンスに快く派遣してくれた DeNA++ です。</p>

<p><a href="http://www.flickr.com/photos/oreillyconf/9083213242/in/set-72157634209656690/"><img src="http://farm6.staticflickr.com/5448/9083213242_27feaaaca5_z.jpg" width="640" height="427"></a></p>

<h2>My Ignite Talk</h2>

<p><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4532318955/takus-22/ref=nosim">&ldquo;不格好経営&rdquo;</a>にも載ってる DeNA の創業者である南場さんの言葉に、<em>&ldquo;これから会社がどんなに長生きしようとも、地球や宇宙の時間のなかでほんの瞬間の存在になる。けれどもなにか宇宙に引っ掻きキズみたいな証を残したい。&rdquo;</em> というものがあります。そこで、Velocity への参加が決まってから、DeNA 社員として何か引っ掻きキズを残せないか考えていたところ、<a href="http://velocityconf.com/velocity2013/public/schedule/detail/29483">Ignite Velocity</a> という LT のセッションを見つけたので、abstract 書いて応募したところ accept されたので LT してきました。</p>

<p>ご存知ない方のために紹介しておくと <a href="http://igniteshow.com/">Ignite</a> は 20 枚のスライドを 15 秒づつ流して、5 分間のプレゼンをするというプレゼン形式で、Velocity 2012 では <a href="http://www.youtube.com/watch?v=Xfu47E5MkJo">DevOps に関する話</a> 等が Youtube にあがってます。</p>

<p><a href="http://www.flickr.com/photos/oreillyconf/9089461762/"><img src="http://l6.yimg.com/so/7374/9089461762_ef95b9fcf7_z.jpg"" width="640" height="427"></a></p>

<p>Ignite が近づくにつれてかなり緊張が高まって、スラダンのミッチー並みにトイレに行ってたのですが、さらに始まる直前になって上の写真のような会場だと分かり、「あ、これ無理だ」と思って、ドラゴンボール Z のミスター・サタンみたいに腹痛起こそうか悩んでたわけですが、Citrix のナイスガイが「みんな酒飲んでるし、ミスったって誰も覚えてないよー」的な話してくれたおかげでだいぶ緊張がほぐれて、自分のトークはリラックスして臨めました。</p>

<p><a href="http://www.flickr.com/photos/oreillyconf/9081016555/"><img src="http://farm4.staticflickr.com/3753/9081016555_9dfbd912a2_z.jpg" width="640" height="428"></a></p>

<p>LT は <a href="https://speakerdeck.com/takus/3-popular-ops-tools-in-japan">3 Pupular Ops Tool in Japan</a> という、(popular がかなり主観ですが) serverspec と GrowthForecast と Fluentd について簡単に紹介するような話で、日本の皆様にはお馴染みの内容ですが、海外の人にとってはちょっとは役立つんじゃないかと思ってこの内容にしたところ、トーク後に fluentd について聞きに来てくれた人がいたり、色んな人から good job とか interesting みたいなお褒めの言葉をいただいたり、以下のようなツイートを頂けたので、小さいながらも引っ掻きキズを残してこれたんじゃないかと思います。</p>

<blockquote><p>@takus doing a great #ignite talk on some popular ops tools in Japan! Very pretty slides and awesome content</p><footer><strong>@sethvargo</strong> <cite><a href='https://twitter.com/sethvargo/status/347198222206386178'>twitter.com/sethvargo/status/&hellip;</a></cite></footer></blockquote>




<blockquote><p>@takus did great and lots of great information, we&#8217;ll be using severspec as soon as I &#8230; feel better from the Anchor Steam  #velocityconf</p><footer><strong>@ckolos</strong> <cite><a href='https://twitter.com/ckolos/status/347200219986948097'>twitter.com/ckolos/status/&hellip;</a></cite></footer></blockquote>


<p><a href="http://www.flickr.com/photos/oreillyconf/9089460246/"><img src="http://farm3.staticflickr.com/2856/9089460246_e0477f5467_z.jpg" width="640" height="428"></a></p>

<p>そして、色々と声かけてもらった中でも、<a href="http://www.amazon.co.jp/exec/obidos/ASIN/4873114934/takus-22/ref=nosim">&ldquo;Web Operations&rdquo;</a> の著者で、Velocity の Program Chair でもある @allspaw が自分のこと覚えててくれて、excellent って言ってくれたのには痺れました(お世辞だと分かっててもw)</p>

<blockquote><p>It was a wonderful moment for me. @allspaw said to me &#8220;your #ignite talk was excellent&#8221;.</p><footer><strong>@takus</strong> <cite><a href='https://twitter.com/takus/status/347527386927083520'>twitter.com/takus/status/&hellip;</a></cite></footer></blockquote>


<h2>Awesome People</h2>

<p><a href="http://www.flickr.com/photos/oreillyconf/9081005095/"><img src="http://farm8.staticflickr.com/7406/9081005095_6f9e32e1e8_z.jpg" width="640" height="427"></a></p>

<p>Velocity ではほんとに色んな人に優しくしてもらいました。ホテルでチップ用の紙幣なくて両替しようとしたら $5 にしか変えれないと言われて困ってたら、通りかかった人が、&#8221;一昨日のトークよかったよ。あとモバゲーのゲームもやったことあるんだ&#8221; って言って 3 ドルくれたり（失礼ながら名前聞くの忘れてしまった&hellip;)、Closing Party で Adobe で働いてるジェラール・ピケ似のイケメンと喋ってたらビール奢ってくれたり、思い返すとそんなエピソードばかりでほんとに参加者が素晴らしかったです！</p>

<h2>Awesome Talks</h2>

<p>素晴らしいトークがたくさんありましたが、全部紹介しきれないので印象深いものだけ簡単にまとめておきます。もうちょっと踏み込んだものはまた後日&hellip;。</p>

<p><a href="http://www.flickr.com/photos/oreillyconf/9087254909/"><img src="http://farm6.staticflickr.com/5527/9087254909_301923410e_z.jpg" width="640" height="427"></a></p>

<h3><a href="http://cdn.oreillystatic.com/en/assets/1/event/94/Avoiding%20Performance%20Regression%20at%20Twitter%20Presentation.pdf">Avoiding Performance Regression at Twitter</a></h3>

<p>機能追加やバグフィックスを反映するたびに性能劣化が起きてしまうのをどのように防ぐかといった内容で、<a href="http://webpagetest.org">WebPageTest</a>、<a href="http://phantomjs.org">PhantomJS</a>、<a href="http://showslow.com">ShowSlow</a> といったツールを使って、branch 毎の TTFT (最初のツイートが表示されるまでの時間) を Jenkins でテストしているそうです。性能が劣化するようなら merge させないといった仕組みなので、性能向上はあっても性能劣化は起きないような仕組みが自動で回るようになっている点がスバラシイですね。</p>

<blockquote><p>@takus thanks! it&#8217;s a matter of either fight against perf regression in an automated fashion or chase whoever causes that and point finger</p><footer><strong>@marcelduran</strong> <cite><a href='https://twitter.com/marcelduran/status/348150304862240768'>twitter.com/marcelduran/status/&hellip;</a></cite></footer></blockquote>


<p>ちなみに、この話すごくよかったのでスピーカーの @marcelduran にリプライしたら、返ってきたリプライまで素晴らしくてさらに感銘を受けました。犯人捜しするのでなく、犯人を作らないような仕組みを考えられる人になりたいですね。</p>

<h3><a href="https://speakerdeck.com/astanway/bring-the-noise-continuously-deploying-under-a-hailstorm-of-metrics">Bring the Noise: Making Effective Use of a Quarter Million Metrics</a></h3>

<p>Etsy といえば、<em>&ldquo;Graph everything&rdquo;</em> とか <em>&ldquo;If it moves, graph it&rdquo;</em> に代表されるようにとにかく何でもグラフにしてることでお馴染みですが、&#8221;たとえグラフの波形が乱れても、誰も見てなかったらそれはスパイクと言えるんだろうか？&#8221; というところから、リアルタイム異常検知とそれに似たグラフを自動で見つける <a href="http://codeascraft.com/2013/06/11/introducing-kale/">Kale</a> の話でした。トークの中で出てきた<a href="https://twitter.com/DEVOPS_BORAT/status/281242898165538818">このツイート</a>でも言ってるように、不味そうな兆候って後で致命的な問題を招くわけで、先ほどの Twitter の話と同じく、問題が小さいうちに対処できるようにしていく部分に Velocity のカルチャーを感じました。</p>

<h3><a href="https://speakerdeck.com/skottler/configuration-management-anti-patterns">Configuration Management Anti-patterns</a></h3>

<p><em>&ldquo;Stop putting upstream modules and cookbooks into your repos&rdquo;</em> という berkshelf とか librarian-chef とか使って使いたいバージョン固定すれば、勝手にバージョンアップされてりしても安心だよねって話が印象に残りました。DeNA のように大規模に色々なシステムが動くような環境で DRY に則って共通化すると、ある環境のために加えた変更が、他の環境に影響を及ぼしてしまうことがたびたびありますが、使う環境毎にきちんとバージョン固定しておけば、そういう苦しみから解放されて、共通化を進めやすくなり、みんなハッピーになれそうだと思いました。</p>

<h2>Future</h2>

<p>Velocity に行って日本のエンジニアのレベルはやっぱ高いんだなと感じました。例えば 3 日目に聞いた MHA のトークはチュートリアル的な内容に留まっていたので、じゃあ DeNA でどのように MHA を運用してるのかって話なんかは当然喋らせてもらえそうで、DeNA のようにグローバルカンパニーを自負する会社や、日頃から素晴らしいツール・ライブラリを公開してるエンジニアの方々はどんどん海外のカンファレンスで喋っていったらいいんじゃないでしょうか！</p>

<p>自分自身については、エンジニアとしてまだまだ半人前の存在だと再認識しながらも、Velocity の本セッションもそんなに遠い場所でないという感触は掴めたので、いつかは本セッションでトークできるように日頃から精進していきたいと思います:D</p>

<h2>Acknowledgments</h2>

<p>最後になりましたが、Velocity に参加するための手配を色々と整えてくれたスーパーヘルパー様と、自分がするべきだった仕事を代わりに引き受けてくださった部署の皆様に心から感謝してます。@katemats が <a href="http://www.youtube.com/watch?v=RGFGdFS_3Cc">If You Don&rsquo;t Understand People, You Don&rsquo;t Understand Ops</a> というトークで <em>You get what you give.</em> って言ってましたが、今回与えてもらった分は必ずお返しします。本当にありがとうございました！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/06/06/code-simplicity/">Code Simplicity</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2013/06/06/code-simplicity/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2013/06/06/code-simplicity/"></a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-06-06T01:26:00+09:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>1:26 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://blog.kentarok.org/entry/2013/06/05/220449">This blog post</a> reminds me of the book I read six months ago.</p>

<p><img src="http://ecx.images-amazon.com/images/I/51W1yF1nI%2BL._SL160_.jpg" alt="Code Simplicity" /><br/>
<a href="http://www.amazon.co.jp/exec/obidos/ASIN/1449313892/takus-22/ref=nosim">Code Simplicity</a></p>

<p>Altough I don&rsquo;t remember the exact sentences in the book, the author wrote something like that:</p>

<blockquote><p>The ultimate goal of software is to help people, and great software is a software that will continue to help people. However, continuing to help people is really difficult because the environment around our software is going to change. As a result, we must maintain our software for continuing to help people. That&rsquo;s why &ldquo;Code Simplicity&rdquo; is needed. We have to keep our code simple for maintaing it easily.</p></blockquote>

<p>This is very similar idea of the author of that blog, isn&rsquo;t it? In the context of web services, we can change the word &lsquo;help people&rsquo; to &lsquo;create the value for customers&rsquo; like that:</p>

<blockquote><p>The ultimate goal of software is to create the value for customers, and great software is a software that will continue to create the value for customers. However, continuing to create the value is really difficult because the environment around our software is going to change. As a result, we must maintain our software for creating the value for customers. That&rsquo;s why &ldquo;Code Simplicity&rdquo; is needed. We have to keep our code simple for maintaing it easily.</p></blockquote>

<p>Do you care for keeping your code simple? If you don&rsquo;t, you might have to pay the huge cost in the future.</p>

<p>大した内容でもないので、なんとなく英語で書いてみた(読んだ本も英語だったので)。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/06/03/rsync-ssh-maxstartups/">rsync が &#8216;ssh_exchange_identification: Connection closed by remote host&#8217; で失敗するときの対処法</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2013/06/03/rsync-ssh-maxstartups/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2013/06/03/rsync-ssh-maxstartups/"></a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-06-03T01:29:00+09:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2013</span></span> <span class='time'>1:29 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>rsync したときに下記のようなエラーでファイル転送が失敗する事案があったので、
<code>/etc/sshd_config</code> の <code>LogLevel</code> を <code>DEBUG 2</code> に変更して再実行したところ、drop connection されていました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>deploy-tool
</span><span class='line'>.
</span><span class='line'>.
</span><span class='line'>.
</span><span class='line'>err:host0001:65280
</span><span class='line'>ssh_exchange_identification: Connection closed by remote host
</span><span class='line'>rsync: connection unexpectedly closed <span class="o">(</span>0 bytes received so far<span class="o">)</span> <span class="o">[</span>sender<span class="o">]</span>
</span><span class='line'>rsync error: unexplained error <span class="o">(</span>code 255<span class="o">)</span> at io.c<span class="o">(</span>600<span class="o">)</span> <span class="o">[</span><span class="nv">sender</span><span class="o">=</span>3.0.6<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo tail -f /var/log/secure | grep <span class="s1">&#39;drop connection&#39;</span>
</span><span class='line'>Jun  1 02:20:40 host0001 sshd<span class="o">[</span>21747<span class="o">]</span>: debug1: drop connection <span class="c">#10</span>
</span><span class='line'>Jun  1 02:20:40 host0001 sshd<span class="o">[</span>21747<span class="o">]</span>: debug1: drop connection <span class="c">#10</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>man</code> を見ると <code>/etc/sshd_config</code> の <code>MaxStartUps</code> が作用してそうだったので <code>MaxStartups</code> を大きな値にして回避しました。
外部から攻撃される可能性がないサーバなら大きな値にしておくとよさそうです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>man sshd_config
</span><span class='line'>  MaxStartups
</span><span class='line'>    Specifies the maximum number of concurrent unauthenticated connections to the SSH daemon.
</span><span class='line'>    Additional connections will be dropped <span class="k">until </span>authentication succeeds or the LoginGraceTime expires <span class="k">for </span>a connection.
</span><span class='line'>    The default is 10.
</span><span class='line'>
</span><span class='line'>    Alternatively, random early drop can be enabled by specifying the three colon separated values “start:rate:full” <span class="o">(</span>e.g. <span class="s2">&quot;10:30:60&quot;</span><span class="o">)</span>.
</span><span class='line'>    sshd<span class="o">(</span>8<span class="o">)</span> will refuse connection attempts with a probability of “rate/100” <span class="o">(</span>30%<span class="o">)</span> <span class="k">if </span>there are currently “start” <span class="o">(</span>10<span class="o">)</span> unauthenticated connectios.
</span><span class='line'>    The probability increases linearly and all connection attempts are refused <span class="k">if </span>the number of unauthenticated connections reaches “full” <span class="o">(</span>60<span class="o">)</span>.
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/05/23/ebs-dev-sdf-dev-xvdj/">CentOS 6 に /dev/sdf としてアタッチした EBS ボリュームが /dev/xvdj として認識される件</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2013/05/23/ebs-dev-sdf-dev-xvdj/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2013/05/23/ebs-dev-sdf-dev-xvdj/"></a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-05-23T02:36:00+09:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2013</span></span> <span class='time'>2:36 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>インスタンスガチャなのかなんなのか、同じくらいの負荷与えてる EBS ボリュームのうち 1 台だけ性能劣化することがあって、ひとまず EC2 の問題なのか EBS の問題なのか切り分けるために EBS ボリュームを作って、AWS のマネジメントコンソールから CentOS 6 のサーバに /dev/sdf としてアタッチしたのに一向にデバイス認識されず、おかしいなと思って調べていたらアタッチしたボリュームと同じサイズのデバイスがあって、ググったら RHEL 6 や CentOS 6 でデバイス名がズレてしまうバグが存在するというオチでした。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># fdisk -l</span>
</span><span class='line'>.
</span><span class='line'>.
</span><span class='line'>.
</span><span class='line'>Disk /dev/xvdj: 429.5 GB, 429496729600 bytes
</span><span class='line'>255 heads, 63 sectors/track, 52216 cylinders
</span><span class='line'><span class="nv">Units</span> <span class="o">=</span> cylinders of 16065 * <span class="nv">512</span> <span class="o">=</span> 8225280 bytes
</span><span class='line'>Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: 512 bytes / 512 bytes
</span><span class='line'>I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: 512 bytes / 512 bytes
</span><span class='line'>Disk identifier: 0x00000000
</span><span class='line'>
</span><span class='line'>Disk /dev/xvdj doesn<span class="err">&#39;</span>t contain a valid partition table
</span></code></pre></td></tr></table></div></figure>


<h2>参考リンク</h2>

<ul>
<li><a href="https://forums.aws.amazon.com/thread.jspa?messageID=336352">CentOS6.2でEBSをマウントする方法</a></li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page4">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page2">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <div style="margin-top:10px">
    <img src="http://farm8.staticflickr.com/7293/11929418323_e084604fe5_q.jpg" alt="me"><br />
    Takumi Sakamoto<br />
    Software Engineer@SmartNews, Inc.<br />
  </div>
  <div style="margin-top:10px">
    <a href="http://twitter.com/takus" class="twitter-follow-button" data-show-count="true">Follow @takus</a>
  </div>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2015/02/26/dd-sushi/">Datadog ユーザの集い #dd_sushi を開催しました</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2015/02/26/dd-sushi/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2015/02/26/dd-sushi/"></a>
      </li>
    
      <li class="post">
        <a href="/2014/11/13/reinvent-2014-day1/">AWS re:Invent 2014 day1</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2014/11/13/reinvent-2014-day1/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2014/11/13/reinvent-2014-day1/"></a>
      </li>
    
      <li class="post">
        <a href="/2014/08/31/yapc-asia-2014/">YAPC::Asia 2014 にいってきた #yapcasia</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2014/08/31/yapc-asia-2014/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2014/08/31/yapc-asia-2014/"></a>
      </li>
    
      <li class="post">
        <a href="/2014/08/01/join-smartnews/">スマートニュースにジョインしました</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2014/08/01/join-smartnews/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2014/08/01/join-smartnews/"></a>
      </li>
    
      <li class="post">
        <a href="/2014/07/31/got-married-and-leave-dena/">結婚しました & 退職します</a><a href="http://b.hatena.ne.jp/entry/http://blog.takus.me/2014/07/31/got-married-and-leave-dena/"><img src="http://b.hatena.ne.jp/entry/image/large/http://blog.takus.me/2014/07/31/got-married-and-leave-dena/"></a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/takus">@takus</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'takus',
            count: 5,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Takumi Sakamoto -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'takus';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
